<mat-toolbar color="primary" class="app-header" *ngIf="user.isConnected">
  <div class="toolbar-left-section">
    <button mat-icon-button class="menu-toggle" [matMenuTriggerFor]="navMenu" aria-label="Toggle menu">
      <mat-icon>menu</mat-icon>
    </button>
    <img src="assets/images/sredi-logo.png" alt="Logo" class="logo" />
    <div class="nav-links">
      <a mat-button routerLink="/integration/result" routerLinkActive="active-link">Home</a>
      <a mat-button routerLink="/integration/timesheet" routerLinkActive="active-link">Timesheet</a>
    </div>
  </div>
  <div class="search-box">
    <integration-search-box></integration-search-box>
  </div>
</mat-toolbar>

<mat-menu #navMenu="matMenu">
  <button mat-menu-item routerLink="/integration/result">Home</button>
  <button mat-menu-item routerLink="/integration/timesheet">Timesheet</button>
</mat-menu>

<div class="integration-header-section">
  <mat-progress-bar *ngIf="sync.isSyncing" mode="indeterminate" color="primary"></mat-progress-bar>
  <mat-accordion>
    <mat-expansion-panel class="panel" [expanded]="expanded" [disabled]="!user.isConnected">
      <mat-expansion-panel-header>
        <div class="header-top">
          <div class="meta">
            <img src="assets/images/github-logo.png" alt="GitHub" class="logo" style="cursor: pointer" />
            <ng-container *ngIf="user.isConnected">
              <mat-icon color="primary" class="status-icon">check_circle</mat-icon>
              <mat-icon class="spinner-icon" *ngIf="sync.isSyncing">sync</mat-icon>
              <mat-icon *ngIf="!sync.isSyncing">history</mat-icon>
            </ng-container>
          </div>
          <div class="user-info lg" *ngIf="user.isConnected">
            <div>
              <div class="info-line">
                {{ user.username }}: {{ user.connectedAt | date: 'yyyy-MM-dd HH:mm a' }}
              </div>
              <div class="info-line">Sync Type: Full</div>
            </div>
          </div>
        </div>
      </mat-expansion-panel-header>

      <div class="auth-section">
        <ng-container *ngIf="user.isLoading; else loadedSection">
          <div class="loader">
            <mat-spinner diameter="24"></mat-spinner>
            <span class="loader-text">Checking integration...</span>
          </div>
        </ng-container>

        <ng-template #loadedSection>
          <ng-container *ngIf="user.isConnected; else connectSection">
            <div class="user-info-section">
              <div class="user-info sx">
                <div class="info-line">
                  {{ user.username }}: {{ user.connectedAt | date: 'yyyy-MM-dd HH:mm a' }}
                </div>
                <div class="info-line">Sync Type: Full</div>
              </div>
              <div>
                <div class="sync sx" *ngIf="sync.isSyncing">
                  {{ sync.message || 'Syncing in progress...' }}
                </div>
              </div>
              <button mat-raised-button color="primary" (click)="disconnect()" class="disconnect-btn">
                Remove
                <mat-icon class="remove-icon">logout</mat-icon>
              </button>
            </div>
          </ng-container>

          <ng-template #connectSection>
            <div class="connect">
              <button mat-raised-button color="primary" (click)="connect()">Connect</button>
              <h3 class="connect-title">Connect Sredio to GitHub</h3>
              <p class="error">{{ user.errorMessage }}</p>
            </div>
          </ng-template>
        </ng-template>
      </div>
    </mat-expansion-panel>
  </mat-accordion>
</div>